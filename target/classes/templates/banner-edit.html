<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>
        后台管理系统
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="./css/x-admin.css" media="all">
</head>

<body>
<div class="x-body" >
    <form class="layui-form" method="post" enctype="multipart/form-data">
        <div class="layui-form-item">
            <label for="khId" class="layui-form-label">
                <span class="x-red">*</span>编号
            </label>
            <div class="layui-input-inline">
                <input type="text" id="khId" name="id" required="" lay-verify="required" th:value="${kh.id}"
                       autocomplete="off" class="layui-input" disabled>
            </div>
        </div>


        <div class="layui-form-item">
            <label for="type" class="layui-form-label">
                <span class="x-red">*</span>服务类型
            </label>
            <div class="layui-input-inline">
                <input type="text" id="type" th:value="${kh.type}" name="type" required="" lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="time" class="layui-form-label">
                <span class="x-red">*</span>服务日期
            </label>
            <div class="layui-input-inline">
                <input type="date" id="time" th:value="${kh.time}" name="time" required="" lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="khName" class="layui-form-label">
                <span class="x-red">*</span>客户名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="khName" name="khName" required="" lay-verify="required" th:value="${kh.khName}"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label"><span class='x-red'>*</span>预估成本</label>
            <div class="layui-input-inline">
                <input class="layui-input" placeholder="请输入成本" id="cost" name="cost" th:value="${kh.cost}" lay-verify="required">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="des" class="layui-form-label">
                <span class="x-red">*</span>内容描述
            </label>
            <div class="layui-input-inline">
                <input type="text" id="des" name="des" required="" lay-verify="required"
                       autocomplete="off" class="layui-input" th:value="${kh.des}">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class='x-red'>*</span>客户满意度
            </label>
            <div class="layui-input-block" >
                <input type="radio" name="manyi" value="很满意" title="很满意" id="m1">
                <div class="layui-unselect layui-form-radio layui-form-radioed"><i class="layui-anim layui-icon layui-anim-scaleSpring"></i>
                    <div  style="font-size: 14px">很满意</div>
                </div>
                <input type="radio" name="manyi" value="比较满意" title="比较满意"id="m2">
                <div class="layui-unselect layui-form-radio"  style="font-size: 14px"><i class="layui-anim layui-icon"></i>
                    <div>比较满意</div>
                </div>
                <input type="radio" name="manyi" value="不满意" title="不满意"id="m3" >
                <div class="layui-unselect layui-form-radio layui-form-radioed"><i class="layui-anim layui-icon layui-anim-scaleSpring"></i>
                    <div  style="font-size: 14px">不满意</div>
                </div>
                <input type="radio" name="manyi" value="很不满意" title="很不满意"id="m4">
                <div class="layui-unselect layui-form-radio"  style="font-size: 14px"><i class="layui-anim layui-icon"></i>
                    <div>很不满意</div>
                </div>

            </div>
        </div>



        <div class="layui-form-item" style="width: 64px;height: 38px"  onclick="update()" >
            <button class="layui-btn"  type="button">
                修改
            </button>
        </div>
        <input type="hidden" name="satisfaction" id="satisfaction"  th:value="${kh.satisfaction}">




    </form>
</div>

<script src="./lib/layui/layui.js" charset="utf-8">
</script>
<script src="./js/x-layui.js" charset="utf-8">
</script>
<script src="./js/jquery-3.2.1.min.js"></script>
<script>
    layui.use(['laydate','element','layer','form'], function(){
        $ = layui.jquery;
        laydate = layui.laydate,//日期插件
            form = layui.form
            ,layer = layui.layer;

        var start = {
            min: '1600-06-16 23:59:59'
            ,max: '2099-06-16 23:59:59'
            ,istoday: false
            ,choose: function(datas){
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
            }
        };
        document.getElementById('bdate').onclick = function(){
            start.elem = this;
            laydate(start);
        }
    });
    $(document).ready(function () {
        var m1=document.getElementById("m1");
        var m2=document.getElementById("m2");
        var m3=document.getElementById("m3");
        var m4=document.getElementById("m4");
        var satisfaction=document.getElementById("satisfaction").value;
        if(satisfaction=="很满意"){
            m1.checked='checked';
        }else if(satisfaction=="比较满意"){
            m2.checked='checked';
        }
        else if(satisfaction=="不满意"){
            m3.checked='checked';
        }else {
            m4.checked='checked';
        }
    })

    //修改
    // form.on('submit(add)', function(data){
    //     console.log(data);
    function update() {

        // var name=$("input[name='name']").val();
        // var url=$("input[name='url']").val();
        // var idn=$("input[name='idn']").val();
        // var company=$("input[name='company']").val();
        // var managerid=$("input[name='managerid']").val();
        // var manager=$("input[name='manager']").val();
        // var phone=$("input[name='phone']").val();
        // var email=$("input[name='email']").val();
        // var bdate=$("input[name='bdate']").val();
        // var edu=$("input[name='edu']").val();
        // var region=$("input[name='region']").val();
        // var tips=$("textarea[name='tips']").val();
        // var gender=$("input[name='gender']:checked").val();

        var type=$("input[name='type']").val();
        var time=$("input[name='time']").val();
        var khName=$("input[name='khName']").val();
        var cost=$("input[name='cost']").val();
        var des=$("input[name='des']").val();
        var satisfaction=$("input[name='manyi']:checked").val();



        var id=$("input[name='id']").val();
        if(type==""||time==""||khName==""||cost==""||des==""||satisfaction=="")
        {
            layer.msg('客户基本信息不能为空！',{icon:5,time:2000});return false;
        }
        // else{
        //     if(url==""){
        //         url="/";
        //     }
        //     if(edu==""){
        //         edu="/";
        //     }
        //     if(tips==""){
        //         tips="/";
        //     }
        //     if(region==""){
        //         region="/";
        //     }
            //发送 ajax请求
            $.ajax({
                url: "/updateKhSatisfaction",
                type: "post",
                data:{"id":id,"type":type,"time":time,"khName":khName,"cost":cost,"des":des,"satisfaction":satisfaction},
                dataType: "json",//返回的数据类型
                success: function (data) {
                    //如果注册成功就跳转到登录页面
                    if (data.info=="修改成功") {
                        layer.alert("修改成功",function (index) {

                            //关闭弹窗
                            // 获得frame索引
                            var index = parent.layer.getFrameIndex(window.name);
                            //关闭当前frame
                            parent.layer.close(index);
                            parent.location.reload();


                        })
                        return false;
                    }
                    else{

                        layer.msg(data.info,{icon:5,time:2000});return false;
                    }
                }
            })

        // }
    }






    //加载文件上传组件
    layui.use('upload', function(){

        var $ = layui.jquery
            ,upload = layui.upload;
        //普通图片上传（上传按钮点击事件）
        var uploadInst = upload.render({
            elem: '#test1'  //通过id绑定按钮点击事件
            ,url: '/upload'  //服务器地址
            ,accept:'url'      //上传的文件类型 （image,file(所有文件)，video，audio（音频））
            ,size:50000       //文件大小
            ,before: function(obj){  //不管上传成功或失败都会执行
                obj.preview(function(index, file, result){
                    //显示上传图片
                    $('#demo1').attr('src', result);
                });
            }
            ,done: function(res){  //访问服务端后执行的函数（res是服务端传回的值）
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
                //提示信息
                var demoText = $('#demoText');
                demoText.html('<span style="color: #4cae4c;">上传成功</span>');

                // var fileupload = $(".image");
                // //把图片在项目中的路径存入到 属性 class=image的input框中
                // fileupload.attr("value",res.data.src);
                $("#url").val(res.src);

                // console.log(fileupload.attr("value"));
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });
    });






</script>

</body>

</html>